<!DOCTYPE html>
<html data-bs-theme="light" lang="de">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>RegineWinkelmann</title>
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/Cabin.css">
    <link rel="stylesheet" href="assets/css/Lora.css">
    <link rel="stylesheet" href="assets/css/Smythe.css">
    <link rel="stylesheet" href="assets/fonts/font-awesome.min.css">
    <link rel="stylesheet" href="assets/css/bss-overrides.css">
    <link rel="stylesheet" href="assets/css/blog-slider.compiled.css">
    <link rel="stylesheet" href="assets/css/Footer-Clean-icons.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css">
    <link rel="stylesheet" href="assets/css/Lightbox-Gallery-baguetteBox.min.css">
    <link rel="stylesheet" href="assets/css/style.compiled.css">
</head>

<body>
    <nav class="navbar navbar-expand-xl fixed-top pb-4 pb-sm-4 pb-md-3 pb-lg-3 pb-xl-3 pb-xxl-3" id="mainNav">
        <div class="container"><a href="index.html#"><img src="assets/img/DachsSymbolEffects.png" width="52" height="50"></a><a class="navbar-brand d-none d-sm-inline-block d-md-inline-block" href="index.html#">Regine Winkelmann</a><button data-bs-toggle="collapse" class="navbar-toggler" data-bs-target="#navbarResponsive" type="button" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation" value="Menu"><i class="fa fa-bars"></i></button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item nav-link"><a class="nav-link" href="index.html#header" data-bs-target="index.html#header">Startseite</a></li>
                    <li class="nav-item nav-link"><a class="nav-link" href="index.html#about">√úber die Autorin</a></li>
                    <li class="nav-item nav-link"><a class="nav-link" href="index.html#product">Der Dachs und die Welt</a></li>
                    <li class="nav-item nav-link"><a class="nav-link" href="#contact">Kontakt</a></li>
                    <li class="nav-item nav-link"><div id="vue-cart-badge" class="nav-link-wrapper" style="visibility: hidden;">
  <a class="nav-link" href="cart.html">
    <span class="d-inline-block d-sm-inline-block d-md-inline-block d-lg-inline-block d-xl-none">Warenkorb</span>
    <i class="fa fa-shopping-basket"></i>
    <span v-if="cartItemCount > 0" class="badge price-badge text-bg-primary text-white">{{ cartItemCount }}</span>
  </a>
</div>

<script type="text/javascript">
(() => {
  function onReady(fn){
    if (document.readyState === "complete" || document.readyState === "interactive") setTimeout(fn,0);
    else document.addEventListener("DOMContentLoaded", fn, { once: true });
  }
  function whenShopAndVue(cb){
    if (window.Shop && window.Vue && window.Vue.createApp) cb();
    else setTimeout(() => whenShopAndVue(cb), 20);
  }

  onReady(() => whenShopAndVue(() => {
    const { createApp } = window.Vue;

    createApp({
      data(){ 
        return { 
          cartItemCount: 0 
        }; 
      },
      methods:{
        updateCount(){
          this.cartItemCount = Shop.cartCount();
        }
      },
      mounted(){
        this.updateCount();
        // Vue ist ready - Element sichtbar machen
        this.$el.style.visibility = 'visible';
        // Live-Updates: reagiert auf Shop.add / sonstige √Ñnderungen
        Shop.onCartChange(() => this.updateCount());
      }
    }).mount('#vue-cart-badge');
  }));
})();
</script></li>
                </ul>
            </div>
        </div>
    </nav>
    <header class="masthead shorthead" style="background: linear-gradient(rgba(0,0,0,0.62) 0%, rgba(0,0,0,0) 22%), url(&quot;assets/img/DachsbuchPromo_004.webp&quot;) center center / cover;height: 50vh;background-size: auto, cover;">
        <div class="intro-body">
            <div class="container">
                <div class="row">
                    <div class="col-lg-8 mx-auto">
                        <h1 class="brand-heading">Vielen Dank!</h1>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <section class="text-center content-section torn" id="checkout">
        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-8 mx-auto"><div id="vue-success-app" style="text-align: center; margin-top: 50px;">
    <h1>Vielen dank f√ºr ihren Einkauf!</h1>
    <p>Ihre Zahlung wurde erfolgreich bearbeitet.</p>
    <p>Wir werden ihre Bestellung in K√ºrze versenden.</p>
    
    <!-- Invoice Button -->
    <a :href="invoiceUrl" 
       target="_blank" 
       class="btn btn-primary text-white"
       :class="{ disabled: isLoading || !invoiceUrl }">
        <i v-if="isLoading" class="fa fa-spinner fa-spin"></i>
        <i v-else class="fa fa-sticky-note"></i>
        {{ buttonText }}
    </a>
</div>
<script type="text/javascript">
(() => {
  function onReady(fn){
    if (document.readyState === "complete" || document.readyState === "interactive") setTimeout(fn,0);
    else document.addEventListener("DOMContentLoaded", fn, { once: true });
  }
  function whenVue(cb){
    if (window.Vue && window.Vue.createApp) cb();
    else setTimeout(() => whenVue(cb), 20);
  }

  onReady(() => whenVue(() => {
    const { createApp } = window.Vue;

    createApp({
      data() {
        return {
          isLoading: true,
          invoiceUrl: null,
          error: null
        };
      },
      computed: {
        buttonText() {
          if (this.isLoading) return 'Rechnung wird geladen...';
          if (this.invoiceUrl) return 'Rechnung anzeigen';
          return 'Rechnung nicht verf√ºgbar';
        }
      },
      methods: {
        async loadInvoice(retryCount = 0) {
          const maxRetries = 3;
          const retryDelays = [3000, 10000, 20000]; // 3s, 10s, 20s - no immediate request
          
          try {
            const urlParams = new URLSearchParams(window.location.search);
            const sessionId = urlParams.get('session_id');
            
            if (!sessionId) {
              this.error = 'Keine Session-ID gefunden';
              this.isLoading = false;
              return;
            }
            
            // Clear cart only on first attempt
            if (retryCount === 0 && window.Shop) {
              window.Shop.clearCart();
            }
            
            const endpoint = Shop.getApiUrl('invoice');
            const response = await fetch(endpoint, {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({ session_id: sessionId })
            });
            
            if (!response.ok) {
              throw new Error(`HTTP ${response.status}`);
            }
            
            const data = await response.json();
            
            if (data.invoice_url) {
              this.invoiceUrl = data.invoice_url;
              this.isLoading = false;
              console.log(`Invoice loaded successfully on attempt ${retryCount + 1}`);
            } else if (retryCount < maxRetries && (data.error || '').includes('not found')) {
              // Invoice not yet available, retry with exponential backoff
              console.log(`Invoice not ready yet, retrying in ${retryDelays[retryCount] / 1000}s (attempt ${retryCount + 1}/${maxRetries})`);
              setTimeout(() => {
                this.loadInvoice(retryCount + 1);
              }, retryDelays[retryCount]);
            } else {
              this.error = data.error || 'Rechnung nicht verf√ºgbar';
              this.isLoading = false;
            }
          } catch (error) {
            console.error('Invoice loading error:', error);
            
            if (retryCount < maxRetries) {
              // Retry on network/server errors too
              console.log(`Network error, retrying in ${retryDelays[retryCount] / 1000}s (attempt ${retryCount + 1}/${maxRetries})`);
              setTimeout(() => {
                this.loadInvoice(retryCount + 1);
              }, retryDelays[retryCount]);
            } else {
              this.error = 'Verbindungsfehler - Bitte Seite neu laden';
              this.isLoading = false;
            }
          }
        }
      },
      mounted() {
        // Wait 5 seconds before first attempt - invoice needs time to be created
        console.log('Invoice loading will start in 5 seconds...');
        setTimeout(() => {
          this.loadInvoice();
        }, 5000);
      }
    }).mount('#vue-success-app');
  }));

  // Confetti Animation
  onReady(() => {
    const count = 200,
    defaults = {
        origin: { y: 0.7 },
    };

    function fire(particleRatio, opts) {
    confetti(
        Object.assign({}, defaults, opts, {
        particleCount: Math.floor(count * particleRatio),
        })
    );
    }

    const emojis = ["üçÅ", "üçÉ"];

    fire(0.25, {
    spread: 26,
    startVelocity: 55,
    shapes: ["emoji"],
        shapeOptions: {
        emoji: {
            value: emojis,
        },
    },
    });

    fire(0.2, {
    spread: 60,
    });

    fire(0.35, {
    spread: 100,
    decay: 0.91,
    scalar: 0.8,
    shapes: ["emoji"],
        shapeOptions: {
        emoji: {
            value: emojis,
        },
    },
    });

    fire(0.1, {
    spread: 120,
    startVelocity: 25,
    decay: 0.92,
    scalar: 1.2,
    shapes: ["emoji"],
        shapeOptions: {
        emoji: {
            value: emojis,
        },
    },
    });

    fire(0.1, {
    spread: 120,
    startVelocity: 45,
    });
  });
})();
</script>

<script src="https://cdn.jsdelivr.net/npm/@tsparticles/confetti@3.0.3/tsparticles.confetti.bundle.min.js"></script>
                    <p></p>
                </div>
            </div>
        </div>
    </section>
    <footer class="py-0">
        <div class="p-3 mb-2">
            <div class="container text-center">
                <div class="row">
                    <div class="col-12 col-sm-12 col-md-5">
                        <p class="my-2">2025 ¬© Regine Winkelmann</p>
                    </div>
                    <div class="col-2 d-none d-sm-none d-md-block"><img src="assets/img/DachsSymbolEffects.png" width="58" height="56"></div>
                    <div class="col-12 col-sm-12 col-md-5">
                        <ul class="list-inline my-2">
                            <li class="list-inline-item"><a href="impressum.html">Impressum</a></li>
                            <li class="list-inline-item"><a href="agb.html">AGB</a></li>
                            <li class="list-inline-item"><a href="widerrufsbelehrung.html">Widerrufsbelehrung</a></li>
                            <li class="list-inline-item"><a href="versand.html">Versand</a></li>
                            <li class="list-inline-item"><a href="datenschutz.html">Datenschutzerkl√§rung</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="p-2" style="background: #1c1c1c;">
            <div class="container text-center">
                <div class="row">
                    <div class="col"><div class="vaax-copyright" id="vaax-button" style="color:#fff;">
    <a href="https://va.ax/" style="color: #fff; text-decoration: none; font-family: Arial, Helvetica, sans-serif;">Webdesign realisiert durch die <i style="content: ''; width: 16px; height: 16px; position: relative; top: 2px; display: inline-block; background-position: center; background-repeat: no-repeat; background-size: contain; background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxODguMjc0IiBoZWlnaHQ9IjE5NC42MiIgdmlld0JveD0iMCAwIDE4OC4yNzQgMTk0LjYyIj4NCiAgPHBhdGggaWQ9IkxvZ29TaW5nbGVXaGl0ZSIgZD0iTTEzOC4yODYsMTguMDdsOTMuODY3LDE0OS42MDdMMjA0LjUxLDE4Mi4zOTFjLTIyLjAxNS0zNS4wNzUtNDMuOTQ0LTcwLTY2LjI0Mi0xMDUuNTIzTDg1LjUwNywxNjEuMDIybDI3LjkyNywxNC44N0wxMzguMywxMzYuMzQ0bDM4LjIyOSw2MC45LTI3LjYxNiwxNC43MTRjLTMuNDQ1LTUuNDMyLTYuODIxLTEwLjc1LTEwLjYxNy0xNi43MjhMMTI3LjQ4MiwyMTIuNjlsLTgzLjYtNDQuMTc3Qzc1LjM3LDExOC4zNDYsMTA2LjY2OCw2OC40NiwxMzguMjg2LDE4LjA3WiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTQzLjg4IC0xOC4wNykiIGZpbGw9IiNmZmYiLz4NCjwvc3ZnPg0K);"></i> <span class="vaax-title">VAAX Multimedia Agentur</span></a>
  </div></div>
                </div>
            </div>
        </div>
    </footer>
    <script src="assets/bootstrap/js/bootstrap.min.js"></script>
    <script src="assets/js/bs-init.js"></script>
    <script src="assets/js/grayscale.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script src="https://js.stripe.com/v3/"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="assets/js/Lightbox-Gallery-baguetteBox.min.js"></script>
    <script src="assets/js/Lightbox-Gallery.js"></script>
    <script src="assets/js/shop.js"></script>
</body>

</html>